<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>True Black Calculator V2</title>
    <style>
        :root {
            --bg-color: #000000;
            --btn-grey: #333333;
            --btn-orange: #ff9f0a;
            --btn-blue: #007AFF;
            --btn-purple: #AF52DE;
            --text-white: #ffffff;
            --text-ghost: #555555;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-white);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Push calculator to bottom */
            overflow: hidden; /* Prevent scrolling */
        }

        /* DISPLAY SECTION */
        #display-container {
            padding: 20px;
            text-align: right;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            word-break: break-all;
        }

        #history {
            font-size: 1.5rem;
            color: var(--text-ghost);
            min-height: 30px;
            margin-bottom: 10px;
        }

        #current-input {
            font-size: 4rem;
            font-weight: 300;
        }

        /* Syntax Highlighting Colors in Display */
        .op-blue { color: var(--btn-blue); }
        .op-purple { color: var(--btn-purple); }
        .num-white { color: var(--text-white); }
        .ghost { color: var(--text-ghost); }

        /* KEYPAD GRID */
        .keypad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 20px;
            padding-bottom: 40px; /* Space for home bar */
            background-color: var(--bg-color);
        }

        /* BUTTON STYLES */
        button {
            border: none;
            border-radius: 50%;
            font-size: 1.8rem;
            height: 80px; /* Fixed height for circle */
            width: 100%;  /* Fill grid cell */
            aspect-ratio: 1; /* Keep circular */
            cursor: pointer;
            transition: opacity 0.2s;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button:active {
            opacity: 0.7;
        }

        /* Color Classes */
        .btn-grey { background-color: var(--btn-grey); }
        .btn-orange { background-color: var(--btn-orange); color: black; font-weight: 500;}
        .btn-blue { background-color: var(--btn-blue); font-size: 2.2rem; }
        .btn-purple { background-color: var(--btn-purple); }
        
        /* Specific Font Sizes */
        .large-symbol { font-size: 2rem; }

        /* LANDSCAPE FIX */
        @media (orientation: landscape) {
            body {
                flex-direction: row;
            }
            #display-container {
                width: 40%;
                justify-content: center;
            }
            .keypad {
                width: 60%;
                padding-bottom: 20px;
                grid-template-rows: repeat(6, 1fr);
                gap: 8px;
            }
            button {
                height: auto; /* Let grid control height */
                border-radius: 15px; /* Squircle in landscape */
                aspect-ratio: auto;
            }
            #current-input { font-size: 3rem; }
        }
    </style>
</head>
<body>

    <div id="display-container">
        <div id="history"></div>
        <div id="current-input">0</div>
    </div>

    <div class="keypad">
        <button class="btn-orange" onclick="clearAll()">AC</button>
        <button class="btn-purple" onclick="inputSymbol('(')">(</button>
        <button class="btn-purple" onclick="inputSymbol(')')">)</button>
        <button class="btn-blue" onclick="backspace()">⌫</button>

        <button class="btn-purple" onclick="inputSymbol('^')">^</button>
        <button class="btn-purple" onclick="inputSymbol('sqrt')">√</button>
        <button class="btn-purple" onclick="inputSymbol('%')">%</button>
        <button class="btn-blue" onclick="inputSymbol('/')">÷</button>

        <button class="btn-grey" onclick="inputNum('7')">7</button>
        <button class="btn-grey" onclick="inputNum('8')">8</button>
        <button class="btn-grey" onclick="inputNum('9')">9</button>
        <button class="btn-blue" onclick="inputSymbol('*')">×</button>

        <button class="btn-grey" onclick="inputNum('4')">4</button>
        <button class="btn-grey" onclick="inputNum('5')">5</button>
        <button class="btn-grey" onclick="inputNum('6')">6</button>
        <button class="btn-blue" onclick="inputSymbol('+')">+</button>

        <button class="btn-grey" onclick="inputNum('1')">1</button>
        <button class="btn-grey" onclick="inputNum('2')">2</button>
        <button class="btn-grey" onclick="inputNum('3')">3</button>
        <button class="btn-blue" onclick="inputSymbol('-')">−</button>

        <button class="btn-grey" onclick="toggleSign()">±</button>
        <button class="btn-grey" onclick="inputNum('0')">0</button>
        <button class="btn-grey" onclick="inputDot()">.</button>
        <button class="btn-blue" onclick="calculate()">=</button>
    </div>

    <script>
        let currentExp = "";
        const displayDiv = document.getElementById('current-input');
        const historyDiv = document.getElementById('history');

        // --- Core Input Logic ---

        function inputNum(num) {
            // Prevent leading zeros issues
            if (currentExp === "0" && num !== ".") currentExp = "";
            currentExp += num;
            updateDisplay();
        }

        function inputSymbol(sym) {
            // Logic to prevent double operators
            const lastChar = currentExp.slice(-1);
            const operators = ['+', '-', '*', '/', '^', '%'];
            
            if (operators.includes(lastChar) && operators.includes(sym)) {
                // Replace last operator
                currentExp = currentExp.slice(0, -1) + sym;
            } else {
                if (sym === 'sqrt') {
                    currentExp += 'sqrt(';
                } else {
                    currentExp += sym;
                }
            }
            updateDisplay();
        }

        // --- Premium Feature: Auto-Decimal Zero ---
        function inputDot() {
            const lastChar = currentExp.slice(-1);
            const operators = ['+', '-', '*', '/', '(', '^', 'sqrt('];
            
            if (currentExp === "" || operators.includes(lastChar)) {
                currentExp += "0.";
            } else if (!currentExp.split(/[\+\-\*\/\^]/).pop().includes('.')) {
                currentExp += ".";
            }
            updateDisplay();
        }

        function clearAll() {
            currentExp = "";
            historyDiv.innerText = "";
            updateDisplay();
        }

        function backspace() {
            if (currentExp.endsWith("sqrt(")) {
                 currentExp = currentExp.slice(0, -5);
            } else {
                currentExp = currentExp.slice(0, -1);
            }
            updateDisplay();
        }

        function toggleSign() {
            // Simple logic: Wrap last number in -() or remove it
            // For now, let's just append a negative sign contextually
            // Note: A full robust toggle requires parsing the math tree
            currentExp += "-"; 
            updateDisplay();
        }

        // --- The Evaluation Engine ---
        function calculate() {
            try {
                let evalExp = currentExp
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/')
                    .replace(/sqrt\(/g, 'Math.sqrt(')
                    .replace(/\^/g, '**');

                // Safety check
                const result = eval(evalExp); 
                
                // Show formatted result
                historyDiv.innerText = currentExp + " =";
                currentExp = result.toString();
                updateDisplay();
            } catch (e) {
                displayDiv.innerText = "Error";
                currentExp = "";
            }
        }

        // --- Syntax Highlighting & Ghost Brackets ---
        function updateDisplay() {
            if (currentExp === "") {
                displayDiv.innerHTML = "0";
                return;
            }

            // 1. Colorize Logic
            // Split by operators to color numbers white and symbols blue/purple
            let formattedHtml = currentExp
                .replace(/([0-9.]+)/g, '<span class="num-white">$1</span>') // Numbers White
                .replace(/([\+\-\*\/])/g, '<span class="op-blue">$1</span>') // Operators Blue
                .replace(/([\(\)\%\^\!])/g, '<span class="op-purple">$1</span>') // Symbols Purple
                .replace(/sqrt/g, '<span class="op-purple">√</span>'); 

            // 2. Ghost Bracket Logic
            const openCount = (currentExp.match(/\(/g) || []).length;
            const closeCount = (currentExp.match(/\)/g) || []).length;
            
            if (openCount > closeCount) {
                const missing = openCount - closeCount;
                formattedHtml += `<span class="ghost">${')'.repeat(missing)}</span>`;
            }

            displayDiv.innerHTML = formattedHtml;
        }
    </script>
</body>
</html>
